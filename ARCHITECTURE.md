# 系统架构图

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    旅游攻略小助手系统                          │
│                  (Swarm Multi-Agent Framework)              │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    SwarmCoordinator                         │
│                  (任务调度与负载均衡)                         │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    Master Agent                             │
│                  (主控智能体 - 指挥官)                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │ 复杂度分析器     │  │ 任务路由        │  │ 结果整合     │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────────┘
                                │
                    ┌───────────┼───────────┐
                    │           │           │
                    ▼           ▼           ▼
        ┌─────────────────┐ ┌─────────────┐ ┌─────────────┐
        │  Planner Agent  │ │Executor Agent│ │ Writer Agent│
        │   (规划器)      │ │  (执行器)   │ │  (生成器)   │
        │                 │ │             │ │             │
        │ ┌─────────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │
        │ │任务分解     │ │ │ │任务执行 │ │ │ │内容整合 │ │
        │ └─────────────┘ │ │ └─────────┘ │ │ └─────────┘ │
        │ ┌─────────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │
        │ │DAG构建      │ │ │ │工具调用 │ │ │ │结果过滤 │ │
        │ └─────────────┘ │ │ └─────────┘ │ │ └─────────┘ │
        │ ┌─────────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │
        │ │依赖分析     │ │ │ │错误处理 │ │ │ │格式美化 │ │
        │ └─────────────┘ │ │ └─────────┘ │ │ └─────────┘ │
        └─────────────────┘ └─────────────┘ └─────────────┘
                    │           │           │
                    └───────────┼───────────┘
                                │
                                ▼
        ┌─────────────────────────────────────────────────────┐
        │                   外部工具层                          │
        │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
        │  │SearchTool   │ │CalculatorTool│ │ComparisonTool│   │
        │  │ (搜索引擎)   │ │ (计算器)    │ │ (比较工具)   │   │
        │  └─────────────┘ └─────────────┘ └─────────────┘   │
        │  ┌─────────────┐ ┌─────────────┐                   │
        │  │Complexity   │ │其他工具...  │                   │
        │  │Analyzer     │ │             │                   │
        │  └─────────────┘ └─────────────┘                   │
        └─────────────────────────────────────────────────────┘
```

## 数据流图

```
用户查询
    │
    ▼
┌─────────────┐
│Master Agent │ ──┐
│复杂度分析   │   │
└─────────────┘   │
    │             │
    ▼             │
┌─────────────┐   │
│简单查询？   │   │
└─────────────┘   │
    │             │
    ▼             │
┌─────────────┐   │
│Writer Agent │   │
│直接生成答案 │   │
└─────────────┘   │
    │             │
    └─────────────┘
    │
    ▼
┌─────────────┐
│复杂查询     │
└─────────────┘
    │
    ▼
┌─────────────┐
│Planner Agent│
│任务分解     │
│DAG构建      │
└─────────────┘
    │
    ▼
┌─────────────┐
│Executor Agent│
│并行执行任务 │
│工具调用     │
└─────────────┘
    │
    ▼
┌─────────────┐
│Writer Agent │
│结果整合     │
│内容过滤     │
└─────────────┘
    │
    ▼
最终答案
```

## 任务调度流程

```
查询提交
    │
    ▼
┌─────────────┐
│任务队列     │
└─────────────┘
    │
    ▼
┌─────────────┐
│工作线程池   │
│(并发处理)   │
└─────────────┘
    │
    ▼
┌─────────────┐
│Master Agent │
│任务分配     │
└─────────────┘
    │
    ▼
┌─────────────┐
│Agent执行    │
│结果收集     │
└─────────────┘
    │
    ▼
┌─────────────┐
│结果返回     │
└─────────────┘
```

## 错误处理机制

```
工具调用失败
    │
    ▼
┌─────────────┐
│重试机制     │
│(最多3次)    │
└─────────────┘
    │
    ▼
┌─────────────┐
│备用工具     │
│自动切换     │
└─────────────┘
    │
    ▼
┌─────────────┐
│错误报告     │
│优雅降级     │
└─────────────┘
```

## 性能监控

```
系统指标
    │
    ▼
┌─────────────┐
│查询统计     │
│- 总查询数   │
│- 成功率     │
│- 响应时间   │
└─────────────┘
    │
    ▼
┌─────────────┐
│资源监控     │
│- 活跃任务   │
│- 内存使用   │
│- CPU负载    │
└─────────────┘
    │
    ▼
┌─────────────┐
│实时报告     │
│性能优化     │
└─────────────┘
```
